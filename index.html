<!DOCTYPE html>
<html>
<head>
    <title>Mileage Tracker</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; }
        .login-box { background: white; padding: 40px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); text-align: center; margin-top: 100px; }
        .password-field { position: relative; margin: 20px 0; }
        .password-input { width: 300px; padding: 12px; border: 2px solid #ddd; border-radius: 5px; font-size: 16px; }
        .eye-btn { position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; font-size: 18px; }
        .login-btn { background: #007bff; color: white; padding: 12px 30px; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; margin-top: 15px; }
        .login-btn:hover { background: #0056b3; }
        .card { background: white; padding: 20px; margin: 20px 0; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .btn { padding: 10px 15px; margin: 5px; border: none; border-radius: 4px; cursor: pointer; }
        .btn-blue { background: #007bff; color: white; }
        .btn-green { background: #28a745; color: white; }
        .btn-gray { background: #6c757d; color: white; }
        .btn-red { background: #dc3545; color: white; }
        .hidden { display: none; }
        .error { color: red; margin: 10px 0; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { padding: 10px; border-bottom: 1px solid #ddd; text-align: left; }
        th { background: #f8f9fa; font-weight: bold; }
        .modal { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); display: flex; align-items: center; justify-content: center; z-index: 1000; }
        .modal-content { background: white; padding: 30px; border-radius: 8px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto; }
        .tabs { display: flex; border-bottom: 2px solid #eee; margin-bottom: 20px; }
        .tab { padding: 12px 20px; cursor: pointer; border-bottom: 3px solid transparent; background: #f8f9fa; margin-right: 5px; border-radius: 5px 5px 0 0; }
        .tab.active { border-bottom-color: #007bff; background: white; font-weight: bold; }
        .list-item { display: flex; justify-content: space-between; align-items: center; padding: 12px; background: #f8f9fa; margin: 8px 0; border-radius: 5px; border-left: 4px solid #007bff; }
        .add-section { background: #f0f8ff; padding: 15px; border-radius: 5px; margin-bottom: 20px; }
        input, select { padding: 8px; margin: 5px; border: 1px solid #ddd; border-radius: 3px; }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen">
        <div class="container">
            <div class="login-box">
                <h1>üöó Mileage Tracker</h1>
                <p>Enter password to access your mileage tracker</p>
                
                <div class="password-field">
                    <input type="password" id="passwordInput" class="password-input" placeholder="Enter password">
                    <button type="button" class="eye-btn" onclick="togglePasswordVisibility()">üëÅÔ∏è</button>
                </div>
                
                <div id="errorMessage" class="error hidden">Incorrect password! Try: mileage123</div>
                
                <button onclick="attemptLogin()" class="login-btn">Login</button>
                
                <p style="margin-top: 20px; color: #666; font-size: 14px;">
                    Password hint: see password prg
                </p>
            </div>
        </div>
    </div>

    <!-- Main Mileage Tracker App -->
    <div id="mainApp" class="hidden">
        <div class="container">
            <div class="card">
                <h1>üöó Mileage Tracker</h1>
                <button class="btn btn-gray" onclick="showManageModal()">‚öôÔ∏è Manage</button>
                <button class="btn btn-blue" onclick="showAddEntryForm()">‚ûï Add New Entry</button>
                <button class="btn btn-green" onclick="exportToCSV()">üì• Export Data</button>
                <p style="margin-top: 15px; font-size: 18px;">
                    <strong>Total Miles: <span id="totalMilesDisplay">0.0</span></strong>
                </p>
            </div>

            <!-- Add Entry Form -->
            <div id="entryForm" class="card hidden">
                <h2>Add Mileage Entry</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                    <input type="date" id="entryDate" required>
                    <input type="number" id="startingMileage" placeholder="Starting mileage" step="0.1">
                    <input type="number" id="endingMileage" placeholder="Ending mileage" step="0.1">
                    <input type="number" id="milesDriven" placeholder="Miles driven" step="0.1">
                    <select id="clientName" required>
                        <option value="">Select Client</option>
                    </select>
                    <select id="vehicleUsed" required>
                        <option value="">Select Vehicle</option>
                    </select>
                    <input type="text" id="tripPurpose" placeholder="Purpose of trip" required style="grid-column: 1/-1;">
                </div>
                <br>
                <button class="btn btn-blue" onclick="saveEntry()">üíæ Save Entry</button>
                <button class="btn btn-gray" onclick="cancelEntry()">‚ùå Cancel</button>
            </div>

            <!-- Entries Display -->
            <div class="card">
                <h2>Your Mileage Entries</h2>
                <div id="entriesDisplay">
                    <p style="text-align: center; color: #666; margin: 30px 0;">
                        No entries yet. Click "Add New Entry" to get started!
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Manage Modal -->
    <div id="manageModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2>‚öôÔ∏è Manage Clients & Vehicles</h2>
                <button onclick="hideManageModal()" style="background: #ff4444; color: white; border: none; font-size: 18px; cursor: pointer; padding: 8px 12px; border-radius: 4px; font-weight: bold;">‚úï Close</button>
            </div>

            <!-- Tabs -->
            <div class="tabs">
                <div id="clientsTab" class="tab active" onclick="showManageTab('clients')">üë• Clients</div>
                <div id="vehiclesTab" class="tab" onclick="showManageTab('vehicles')">üöó Vehicles</div>
            </div>

            <!-- Delete Confirmation Banner -->
            <div id="deleteConfirmBanner" class="hidden" style="background: #ffe6e6; border: 2px solid #ff9999; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
                <h4 style="color: #cc0000; margin: 0 0 10px 0;">‚ö†Ô∏è Confirm Deletion</h4>
                <p id="deleteMessage" style="margin: 0 0 10px 0; color: #cc0000;"></p>
                <button onclick="confirmDeletion()" class="btn btn-red">Delete</button>
                <button onclick="cancelDeletion()" class="btn btn-gray">Cancel</button>
            </div>

            <!-- Clients Content -->
            <div id="clientsContent">
                <div class="add-section">
                    <h3>‚ûï Add New Client</h3>
                    <input type="text" id="newClientName" placeholder="Enter client name" style="width: 250px;">
                    <button onclick="addNewClient()" class="btn btn-blue">Add Client</button>
                </div>
                <div id="clientsList"></div>
            </div>

            <!-- Vehicles Content -->
            <div id="vehiclesContent" class="hidden">
                <div class="add-section">
                    <h3>‚ûï Add New Vehicle</h3>
                    <input type="text" id="newVehicleName" placeholder="e.g., 2023 Honda Accord" style="width: 250px;">
                    <button onclick="addNewVehicle()" class="btn btn-blue">Add Vehicle</button>
                </div>
                <div id="vehiclesList"></div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let mileageEntries = [];
        let availableClients = ['ABC Corporation', 'XYZ LLC', 'Smith & Associates'];
        let availableVehicles = ['2023 Honda Accord', '2022 Toyota Camry', '2021 Ford F-150'];
        let isPasswordVisible = false;
        let pendingDelete = null;

        // Password functions
        function togglePasswordVisibility() {
            const passwordInput = document.getElementById('passwordInput');
            const eyeButton = document.querySelector('.eye-btn');
            
            if (isPasswordVisible) {
                passwordInput.type = 'password';
                eyeButton.textContent = 'üëÅÔ∏è';
                isPasswordVisible = false;
            } else {
                passwordInput.type = 'text';
                eyeButton.textContent = 'üôà';
                isPasswordVisible = true;
            }
        }

        function attemptLogin() {
            const enteredPassword = document.getElementById('passwordInput').value;
            const errorDiv = document.getElementById('errorMessage');
            
            console.log('Password entered:', enteredPassword);
            
            if (enteredPassword === 'mileageB3v') {
                console.log('Login successful!');
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('mainApp').classList.remove('hidden');
                setupApp();
            } else {
                console.log('Login failed');
                errorDiv.classList.remove('hidden');
                document.getElementById('passwordInput').value = '';
            }
        }

        // Allow Enter key to login
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('passwordInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    attemptLogin();
                }
            });
        });

        // Main app functions
        function setupApp() {
            document.getElementById('entryDate').value = new Date().toISOString().split('T')[0];
            updateClientVehicleSelects();
            updateDisplay();
        }

        function showAddEntryForm() {
            document.getElementById('entryForm').classList.remove('hidden');
            document.getElementById('entryDate').value = new Date().toISOString().split('T')[0];
        }

        function cancelEntry() {
            document.getElementById('entryForm').classList.add('hidden');
            clearEntryForm();
        }

        function clearEntryForm() {
            document.getElementById('entryDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('startingMileage').value = '';
            document.getElementById('endingMileage').value = '';
            document.getElementById('milesDriven').value = '';
            document.getElementById('clientName').value = '';
            document.getElementById('vehicleUsed').value = '';
            document.getElementById('tripPurpose').value = '';
        }

        function updateClientVehicleSelects() {
            // Update client dropdown
            const clientSelect = document.getElementById('clientName');
            clientSelect.innerHTML = '<option value="">Select Client</option>';
            availableClients.forEach(client => {
                clientSelect.innerHTML += `<option value="${client}">${client}</option>`;
            });

            // Update vehicle dropdown
            const vehicleSelect = document.getElementById('vehicleUsed');
            vehicleSelect.innerHTML = '<option value="">Select Vehicle</option>';
            availableVehicles.forEach(vehicle => {
                vehicleSelect.innerHTML += `<option value="${vehicle}">${vehicle}</option>`;
            });
        }

        function saveEntry() {
            const date = document.getElementById('entryDate').value;
            const startMiles = parseFloat(document.getElementById('startingMileage').value) || 0;
            const endMiles = parseFloat(document.getElementById('endingMileage').value) || 0;
            let totalMiles = parseFloat(document.getElementById('milesDriven').value) || 0;
            const client = document.getElementById('clientName').value.trim();
            const vehicle = document.getElementById('vehicleUsed').value.trim();
            const purpose = document.getElementById('tripPurpose').value.trim();

            // Auto-calculate if start and end provided
            if (startMiles > 0 && endMiles > startMiles) {
                totalMiles = endMiles - startMiles;
            }

            // Validation
            if (!date || !client || !vehicle || !purpose || totalMiles <= 0) {
                alert('Please fill in all required fields and ensure miles driven is greater than 0');
                return;
            }

            // Save entry
            const newEntry = {
                id: Date.now(),
                date: date,
                startMiles: startMiles || null,
                endMiles: endMiles || null,
                totalMiles: totalMiles,
                client: client,
                vehicle: vehicle,
                purpose: purpose
            };

            mileageEntries.push(newEntry);
            updateDisplay();
            cancelEntry();
            alert('Entry saved successfully!');
        }

        function deleteEntry(entryId) {
            if (confirm('Are you sure you want to delete this entry?')) {
                mileageEntries = mileageEntries.filter(entry => entry.id !== entryId);
                updateDisplay();
            }
        }

        function updateDisplay() {
            const totalMiles = mileageEntries.reduce((sum, entry) => sum + entry.totalMiles, 0);
            document.getElementById('totalMilesDisplay').textContent = totalMiles.toFixed(1);

            const displayDiv = document.getElementById('entriesDisplay');
            
            if (mileageEntries.length === 0) {
                displayDiv.innerHTML = '<p style="text-align: center; color: #666; margin: 30px 0;">No entries yet. Click "Add New Entry" to get started!</p>';
                return;
            }

            let tableHTML = `
                <table>
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Start Miles</th>
                            <th>End Miles</th>
                            <th>Miles Driven</th>
                            <th>Client</th>
                            <th>Vehicle</th>
                            <th>Purpose</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            mileageEntries.sort((a, b) => new Date(b.date) - new Date(a.date)).forEach(entry => {
                tableHTML += `
                    <tr>
                        <td>${entry.date}</td>
                        <td>${entry.startMiles ? entry.startMiles.toFixed(1) : '-'}</td>
                        <td>${entry.endMiles ? entry.endMiles.toFixed(1) : '-'}</td>
                        <td><strong>${entry.totalMiles.toFixed(1)}</strong></td>
                        <td>${entry.client}</td>
                        <td>${entry.vehicle}</td>
                        <td>${entry.purpose}</td>
                        <td><button class="btn btn-red" onclick="deleteEntry(${entry.id})">üóëÔ∏è Delete</button></td>
                    </tr>
                `;
            });

            tableHTML += '</tbody></table>';
            displayDiv.innerHTML = tableHTML;
        }

        function exportToCSV() {
            if (mileageEntries.length === 0) {
                alert('No data to export');
                return;
            }

            let csvContent = 'Date,Start Mileage,End Mileage,Miles Driven,Client,Vehicle,Purpose\n';
            
            mileageEntries.forEach(entry => {
                csvContent += `${entry.date},${entry.startMiles || ''},${entry.endMiles || ''},${entry.totalMiles},"${entry.client}","${entry.vehicle}","${entry.purpose}"\n`;
            });

            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'mileage_report.csv';
            link.click();
            window.URL.revokeObjectURL(url);
        }

        // Manage Modal Functions
        function showManageModal() {
            document.getElementById('manageModal').style.display = 'flex';
            updateManageDisplay();
        }

        function hideManageModal() {
            document.getElementById('manageModal').style.display = 'none';
            cancelDeletion();
        }

        function showManageTab(tabName) {
            // Update tab appearance
            document.getElementById('clientsTab').classList.remove('active');
            document.getElementById('vehiclesTab').classList.remove('active');
            document.getElementById(tabName + 'Tab').classList.add('active');

            // Show/hide content
            if (tabName === 'clients') {
                document.getElementById('clientsContent').classList.remove('hidden');
                document.getElementById('vehiclesContent').classList.add('hidden');
            } else {
                document.getElementById('vehiclesContent').classList.remove('hidden');
                document.getElementById('clientsContent').classList.add('hidden');
            }
        }

        function addNewClient() {
            const newClientName = document.getElementById('newClientName').value.trim();
            if (!newClientName) {
                alert('Please enter a client name');
                return;
            }
            if (availableClients.includes(newClientName)) {
                alert('This client already exists');
                return;
            }
            availableClients.push(newClientName);
            document.getElementById('newClientName').value = '';
            updateManageDisplay();
            updateClientVehicleSelects();
        }

        function addNewVehicle() {
            const newVehicleName = document.getElementById('newVehicleName').value.trim();
            if (!newVehicleName) {
                alert('Please enter a vehicle description');
                return;
            }
            if (availableVehicles.includes(newVehicleName)) {
                alert('This vehicle already exists');
                return;
            }
            availableVehicles.push(newVehicleName);
            document.getElementById('newVehicleName').value = '';
            updateManageDisplay();
            updateClientVehicleSelects();
        }

        function promptDeleteClient(clientName) {
            pendingDelete = { type: 'client', name: clientName };
            document.getElementById('deleteMessage').textContent = `Are you sure you want to delete client: "${clientName}"?`;
            document.getElementById('deleteConfirmBanner').classList.remove('hidden');
        }

        function promptDeleteVehicle(vehicleName) {
            pendingDelete = { type: 'vehicle', name: vehicleName };
            document.getElementById('deleteMessage').textContent = `Are you sure you want to delete vehicle: "${vehicleName}"?`;
            document.getElementById('deleteConfirmBanner').classList.remove('hidden');
        }

        function confirmDeletion() {
            if (!pendingDelete) return;
            
            if (pendingDelete.type === 'client') {
                availableClients = availableClients.filter(c => c !== pendingDelete.name);
            } else if (pendingDelete.type === 'vehicle') {
                availableVehicles = availableVehicles.filter(v => v !== pendingDelete.name);
            }
            
            updateManageDisplay();
            updateClientVehicleSelects();
            cancelDeletion();
        }

        function cancelDeletion() {
            pendingDelete = null;
            document.getElementById('deleteConfirmBanner').classList.add('hidden');
        }

        function updateManageDisplay() {
            // Update clients list
            const clientsList = document.getElementById('clientsList');
            clientsList.innerHTML = '<h3>üìã Current Clients:</h3>';
            if (availableClients.length === 0) {
                clientsList.innerHTML += '<p style="color: #666;">No clients added yet.</p>';
            } else {
                availableClients.forEach(client => {
                    clientsList.innerHTML += `
                        <div class="list-item">
                            <span><strong>${client}</strong></span>
                            <button onclick="promptDeleteClient('${client}')" class="btn btn-red">üóëÔ∏è Delete</button>
                        </div>
                    `;
                });
            }

            // Update vehicles list
            const vehiclesList = document.getElementById('vehiclesList');
            vehiclesList.innerHTML = '<h3>üöó Current Vehicles:</h3>';
            if (availableVehicles.length === 0) {
                vehiclesList.innerHTML += '<p style="color: #666;">No vehicles added yet.</p>';
            } else {
                availableVehicles.forEach(vehicle => {
                    vehiclesList.innerHTML += `
                        <div class="list-item">
                            <span><strong>${vehicle}</strong></span>
                            <button onclick="promptDeleteVehicle('${vehicle}')" class="btn btn-red">üóëÔ∏è Delete</button>
                        </div>
                    `;
                });
            }
        }
    </script>

<!-- MileagePro simple browser persistence (GitHub Pages safe) -->
<script>
(function () {
  const KEY = 'mp_autosave_v1';
  try {
    const raw = localStorage.getItem(KEY);
    if (raw) {
      const saved = JSON.parse(raw);
      if (saved.vehicles) window.vehicles = saved.vehicles;
      if (saved.clients)  window.clients  = saved.clients;
      if (saved.entries)  window.entries  = saved.entries;
      if (saved.settings) window.settings = saved.settings;
    }
  } catch (e) { console.warn('Autosave restore failed', e); }

  function autosave() {
    try {
      const pack = {
        vehicles: window.vehicles || [],
        clients:  window.clients  || [],
        entries:  window.entries  || [],
        settings: window.settings || {}
      };
      localStorage.setItem(KEY, JSON.stringify(pack));
    } catch (e) { console.warn('Autosave save failed', e); }
  }

  window.addEventListener('beforeunload', autosave);
  setInterval(autosave, 10000);
  window.MP = {
    save: autosave,
    reset: () => { localStorage.removeItem(KEY); location.reload(); },
    dump: () => JSON.parse(localStorage.getItem(KEY) || '{}')
  };
})();
</script>
</body>
</html>
